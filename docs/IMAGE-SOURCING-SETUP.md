# Add-on Image Sourcing & Optimization Setup

## Overview

This document provides complete setup instructions for downloading and optimizing add-on images from Pexels for the Med USA 4WD Tours storefront.

## Status: Ready to Execute

All infrastructure has been created. You only need to:
1. Get a free Pexels API key
2. Run the script
3. Verify results

---

## ğŸ“‹ Prerequisites

### 1. Pexels API Key (Required)

**Get your FREE Pexels API key:**

1. Visit: https://www.pexels.com/api/
2. Click "Get Started" or "Sign Up"
3. Create a free account (no credit card required)
4. Navigate to your API section
5. Generate a new API key

**Pexels Free Tier:**
- âœ… 200 requests per hour
- âœ… 20,000 requests per month
- âœ… Commercial use allowed
- âœ… No attribution required (but appreciated)
- âœ… High-quality images (up to 8000px)

### 2. Dependencies

Already installed in your project:
- âœ… Sharp library (v0.34.5) - Image optimization
- âœ… Node.js - Script runtime
- âœ… HTTPS module - Image downloads

---

## ğŸš€ Quick Start

### Step 1: Set Your API Key

```bash
# Option A: Set for single command (recommended for testing)
export PEXELS_API_KEY=your_api_key_here

# Option B: Add to .env.local (recommended for development)
echo "PEXELS_API_KEY=your_api_key_here" >> /Users/Karim/med-usa-4wd/storefront/.env.local
```

### Step 2: Run the Script

```bash
cd /Users/Karim/med-usa-4wd/storefront

# Run with explicit API key
PEXELS_API_KEY=your_api_key_here node scripts/download-optimize-addon-images.js

# Or if you added to .env.local
source .env.local && node scripts/download-optimize-addon-images.js
```

### Step 3: Verify Results

After successful execution, you should see:

```
âœ… Successfully processed: 8/8 addons
ğŸ“ Images saved to: /Users/Karim/med-usa-4wd/storefront/public/images/addons
ğŸ“„ Manifest: /Users/Karim/med-usa-4wd/docs/addon-images-manifest.json
ğŸ“„ Metadata: /Users/Karim/med-usa-4wd/storefront/public/images/addons/metadata.json
```

---

## ğŸ“ File Structure

### Created Files

```
/Users/Karim/med-usa-4wd/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ addon-image-mapping.json          âœ… Created - Search terms & requirements
â”‚   â”œâ”€â”€ addon-images-manifest.json        â³ Generated by script
â”‚   â””â”€â”€ IMAGE-SOURCING-SETUP.md           âœ… Created - This file
â”‚
â””â”€â”€ storefront/
    â”œâ”€â”€ scripts/
    â”‚   â””â”€â”€ download-optimize-addon-images.js  âœ… Created - Main script
    â”‚
    â””â”€â”€ public/images/addons/
        â”œâ”€â”€ metadata.json                      â³ Generated by script
        â”‚
        â”œâ”€â”€ gourmet-picnic-lunch-original.jpg
        â”œâ”€â”€ gourmet-picnic-lunch-640w.webp
        â”œâ”€â”€ gourmet-picnic-lunch-640w.avif
        â”œâ”€â”€ gourmet-picnic-lunch-750w.webp
        â”œâ”€â”€ gourmet-picnic-lunch-750w.avif
        â”œâ”€â”€ gourmet-picnic-lunch-828w.webp
        â”œâ”€â”€ gourmet-picnic-lunch-828w.avif
        â”œâ”€â”€ gourmet-picnic-lunch-1080w.webp
        â”œâ”€â”€ gourmet-picnic-lunch-1080w.avif
        â”œâ”€â”€ gourmet-picnic-lunch-1200w.webp
        â”œâ”€â”€ gourmet-picnic-lunch-1200w.avif
        â”œâ”€â”€ gourmet-picnic-lunch-1920w.webp
        â”œâ”€â”€ gourmet-picnic-lunch-1920w.avif
        â”‚
        â””â”€â”€ ... (same pattern for all 8 addons)
```

---

## ğŸ¯ What the Script Does

### 1. Image Sourcing
- Searches Pexels API for high-quality, royalty-free images
- Uses curated search terms from `addon-image-mapping.json`
- Selects landscape-oriented images (suitable for cards)
- Downloads original quality (large2x or original)
- Falls back to alternate search terms if needed

### 2. Image Optimization
- Converts to WebP (85% quality)
- Converts to AVIF (80% quality)
- Keeps original as JPEG (90% quality)
- Generates 6 responsive sizes: [640, 750, 828, 1080, 1200, 1920]px
- Total: 13 files per addon (1 original + 6 WebP + 6 AVIF)

### 3. Attribution & Metadata
- Records photographer name and profile URL
- Stores Pexels photo ID and URL
- Generates SEO-optimized alt text
- Creates complete license information
- Tracks download timestamps

### 4. Performance Optimization
- Rate limiting (1s between requests)
- Error handling with graceful degradation
- Progress tracking and detailed logging
- Respects Pexels API limits

---

## ğŸ“Š Add-on Image Requirements

All images sourced based on these specifications:

| Add-on | Category | Search Terms | Requirements |
|--------|----------|--------------|--------------|
| Gourmet Picnic Lunch | Food & Beverage | "gourmet picnic basket" | Premium food, outdoor setting |
| Professional Photography | Photography | "professional photographer outdoor" | Photographer in action |
| GoPro Camera Rental | Equipment | "action camera adventure" | Action camera or filming |
| Camping Equipment | Equipment | "camping tent equipment" | Quality camping setup |
| Wildlife Binoculars | Equipment | "binoculars wildlife watching" | Binoculars in use |
| Sunset Champagne | Food & Beverage | "champagne sunset beach" | Champagne with sunset |
| Hotel Pickup | Transport | "4wd vehicle pickup" | Modern transport vehicle |
| Travel Insurance | Insurance | "travel insurance protection" | Safety/protection concept |

---

## ğŸ” Manifest Structure

The generated `addon-images-manifest.json` will have this structure:

```json
{
  "generated_at": "2025-11-09T...",
  "total_images": 8,
  "pexels_license": "Pexels Free License - https://www.pexels.com/license/",
  "images": [
    {
      "addon_id": "addon-1",
      "addon_handle": "gourmet-picnic-lunch",
      "addon_name": "Gourmet Picnic Lunch",
      "category": "Food & Beverage",
      "source_url": "https://www.pexels.com/photo/...",
      "pexels_id": 123456,
      "photographer": "John Doe",
      "photographer_url": "https://www.pexels.com/@johndoe",
      "formats": {
        "webp": [
          "gourmet-picnic-lunch-640w.webp",
          "gourmet-picnic-lunch-750w.webp",
          "gourmet-picnic-lunch-828w.webp",
          "gourmet-picnic-lunch-1080w.webp",
          "gourmet-picnic-lunch-1200w.webp",
          "gourmet-picnic-lunch-1920w.webp"
        ],
        "avif": [
          "gourmet-picnic-lunch-640w.avif",
          "gourmet-picnic-lunch-750w.avif",
          "gourmet-picnic-lunch-828w.avif",
          "gourmet-picnic-lunch-1080w.avif",
          "gourmet-picnic-lunch-1200w.avif",
          "gourmet-picnic-lunch-1920w.avif"
        ],
        "original": "gourmet-picnic-lunch-original.jpg"
      },
      "alt_text": "Gourmet Picnic Lunch - Premium dining experience for 4WD tours on Sunshine Coast",
      "license": "Pexels Free License"
    }
  ]
}
```

---

## ğŸ¨ Using Images in Components

### Option 1: Next.js Image Component (Recommended)

```jsx
import Image from 'next/image';

export function AddonCard({ addon }) {
  return (
    <div className="addon-card">
      <Image
        src={`/images/addons/${addon.handle}-1200w.webp`}
        alt={addon.altText}
        width={1200}
        height={800}
        sizes="(max-width: 640px) 640px, (max-width: 1200px) 1200px, 1920px"
        loading="lazy"
      />
    </div>
  );
}
```

### Option 2: Picture Element with Fallback

```html
<picture>
  <!-- AVIF for modern browsers -->
  <source
    type="image/avif"
    srcset="
      /images/addons/gourmet-picnic-lunch-640w.avif 640w,
      /images/addons/gourmet-picnic-lunch-1200w.avif 1200w,
      /images/addons/gourmet-picnic-lunch-1920w.avif 1920w
    "
    sizes="(max-width: 640px) 640px, (max-width: 1200px) 1200px, 1920px"
  />

  <!-- WebP for wider support -->
  <source
    type="image/webp"
    srcset="
      /images/addons/gourmet-picnic-lunch-640w.webp 640w,
      /images/addons/gourmet-picnic-lunch-1200w.webp 1200w,
      /images/addons/gourmet-picnic-lunch-1920w.webp 1920w
    "
    sizes="(max-width: 640px) 640px, (max-width: 1200px) 1200px, 1920px"
  />

  <!-- JPEG fallback -->
  <img
    src="/images/addons/gourmet-picnic-lunch-original.jpg"
    alt="Gourmet Picnic Lunch - Premium dining experience"
    loading="lazy"
  />
</picture>
```

---

## âš¡ Performance Impact

### Expected PageSpeed Improvements

**Before (SVG placeholders):**
- Limited visual appeal
- Generic icons

**After (Optimized images):**
- âœ… Modern WebP/AVIF formats (30-50% smaller than JPEG)
- âœ… Responsive images (right size for device)
- âœ… Lazy loading (below-fold images)
- âœ… Proper dimensions (prevent CLS)
- âœ… Maintained 90+ PageSpeed score

### File Size Comparison (Estimated per image)

| Format | Size | Savings |
|--------|------|---------|
| Original JPEG (1920px) | ~800 KB | Baseline |
| WebP (1920px) | ~400 KB | 50% smaller |
| AVIF (1920px) | ~300 KB | 62% smaller |
| WebP (640px) | ~80 KB | 90% smaller |

---

## ğŸ”’ Licensing & Attribution

### Pexels Free License

All images are covered by the [Pexels Free License](https://www.pexels.com/license/):

âœ… **Allowed:**
- Commercial use
- Modification
- Distribution
- No attribution required (but appreciated)

âŒ **Not Allowed:**
- Selling unmodified photos
- Implying endorsement
- Compiling into competitor products

### Optional Attribution

While not required, you can add attribution in your footer or credits page:

```html
<p>
  Photography by
  <a href="{photographer_url}" target="_blank" rel="noopener">
    {photographer_name}
  </a>
  via
  <a href="https://www.pexels.com" target="_blank" rel="noopener">
    Pexels
  </a>
</p>
```

---

## ğŸ› Troubleshooting

### Error: "PEXELS_API_KEY environment variable is required"

**Solution:** Set your API key before running:
```bash
export PEXELS_API_KEY=your_key_here
node scripts/download-optimize-addon-images.js
```

### Error: "No photos found"

**Solution:** The script automatically tries alternate search terms. If all fail:
1. Check your API key is valid
2. Verify you haven't exceeded rate limits (200/hour)
3. Manually edit search terms in `addon-image-mapping.json`

### Error: "Failed to download"

**Solution:**
- Check internet connection
- Verify Pexels API is accessible
- Try running script again (network issue may be temporary)

### Low-quality images

**Solution:**
1. Open `addon-image-mapping.json`
2. Modify `pexels_search_terms` for the addon
3. Re-run the script

---

## ğŸ“ˆ Monitoring & Validation

### After Running Script

1. **Check image count:**
   ```bash
   ls -l /Users/Karim/med-usa-4wd/storefront/public/images/addons/ | wc -l
   # Expected: ~105 files (8 addons Ã— 13 files each + metadata.json)
   ```

2. **Verify file sizes:**
   ```bash
   du -sh /Users/Karim/med-usa-4wd/storefront/public/images/addons/
   # Expected: ~15-25 MB total
   ```

3. **Check manifest:**
   ```bash
   cat /Users/Karim/med-usa-4wd/docs/addon-images-manifest.json | grep "total_images"
   # Expected: "total_images": 8
   ```

4. **Test in browser:**
   - Start dev server: `npm run dev`
   - Navigate to addon pages
   - Verify images load correctly
   - Check DevTools Network tab for format selection

5. **Run PageSpeed Insights:**
   ```bash
   # After deploying to staging/production
   # Visit: https://pagespeed.web.dev/
   # Test both mobile and desktop
   # Target: 90+ score
   ```

---

## ğŸ”„ Re-running or Updating

### To replace a specific addon image:

1. Edit search terms in `addon-image-mapping.json`
2. Run script again (it will overwrite existing files)

### To add new addons:

1. Add entry to `addon-image-mapping.json`
2. Run script again (only processes new entries)

### To change optimization settings:

Edit script constants:
```javascript
const RESPONSIVE_WIDTHS = [640, 750, 828, 1080, 1200, 1920];
const WEBP_QUALITY = 85;
const AVIF_QUALITY = 80;
```

---

## ğŸ“ Support

### Pexels API Support
- Documentation: https://www.pexels.com/api/documentation/
- Support: https://help.pexels.com/

### Script Issues
- Check error messages in console
- Review this documentation
- Verify all prerequisites are met

---

## âœ… Success Checklist

Before marking as complete:

- [ ] Obtained Pexels API key
- [ ] Set PEXELS_API_KEY environment variable
- [ ] Ran download-optimize-addon-images.js successfully
- [ ] Verified 8 addons processed
- [ ] Checked addon-images-manifest.json generated
- [ ] Verified metadata.json in addons directory
- [ ] Tested images display correctly in components
- [ ] Confirmed WebP/AVIF formats load in modern browsers
- [ ] Verified JPEG fallback works in older browsers
- [ ] Ran PageSpeed test (target: 90+)
- [ ] Documented any customizations or issues

---

**Last Updated:** 2025-11-09
**Status:** Ready for execution
**Estimated Time:** 5-10 minutes (including API key setup)
